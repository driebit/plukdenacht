var canvasApp=function(){function e(){console.log("init canvas app, start init other modules"),_=n()}function n(){return{players:{}}}function t(e){return _.players[e]={id:e},_}function r(e){return _.players[e]}function a(e,n,t){return w("setplayerprop "+n+" : "+t),r(e)[n]=t}function s(e,n,t){var r,a,s=e,o=setInterval(function(){r=parseInt(s/60,10),a=parseInt(s%60,10),r=10>r?"0"+r:r,a=10>a?"0"+a:a,n&&n.text(r+":"+a),--s<0&&(s=e,t(),clearInterval(o))},1e3)}function o(){document.querySelector("#countdown_label").innerText="Starting in...",s(30,$("#countdown__minutes"),i)}function i(){document.querySelector("#countdown_label").innerText="Pull!",Object.keys(_.players).map(function(e){var n=r(e);n.channel.set("isrunning",1)}),s(30,$("#countdown__minutes"),c)}function c(){document.querySelector("#countdown_label").innerText="Finished, standby",Object.keys(_.players).map(function(e){var n=r(e);n.channel.set("isrunning",0)}),window.setTimeout(function(){b("scores");var e=v("left"),n=v("right"),t=$(".canvas--scores__players"),r=null;e>n?($(".canvas--scores").addClass("left-won"),$(".canvas--scores__title h1").html("the eagles won!"),r="left"):($(".canvas--scores").addClass("right-won"),$(".canvas--scores__title h1").html("the bulls won!"),r="right"),l(r).sort(function(e,n){return n.score-e.score}).map(function(e){e.photo&&t.append('<li><img src="'+e.photo+'"><div>'+e.score+"</div></li>")}),s(30,null,u)},7e3)}function u(){b("endgame")}function l(e){var n=Object.keys(_.players).map(function(e){var n=r(e);return n}).filter(function(n){return n.team===e});return n}function d(){var e=Object.keys(_.players).map(function(e){var n=r(e);return n}),n=e.map(function(e){return e.score}).reduce(function(e,n){return e+n},0);return n}function f(e){var n=(Object.keys(_.players).map(function(e){var n=r(e);return n}),l(e).map(function(e){return e.score}).reduce(function(e,n){return e+n},0));return n}function v(e){var n=d();return 0==n?50:100*f(e)/n}function m(e){var n,t=r(e);n=t.photo?$('<li class="member"><img src="'+t.photo+'"></li>'):$('<li class="member"></li>');var a=T[t.team],s=$('div[class^="player-wrapper__team-'+t.team+'"]'),o=s.find(".block--"+a),i=o.find("li").size();i+1>C&&(T[t.team]++,T[t.team]%2!=0&&C--,a=T[t.team]),o.append(n)}function p(){var e=v("left"),n=v("right");$("#totalTeamA").height(e+"%"),$("#totalTeamB").height(n+"%"),w("team left: "+e+" right: "+n)}function g(){var e=v("right"),n=$(".teams-wrapper");n.css({"margin-left":160*e/100})}function h(){p(),g()}function y(){return _}function b(e){$('div[class^="canvas--"]').removeClass("is-active").addClass("is-not-active"),"scores"==e?$(".canvas--scores").removeClass("is-not-active").addClass("is-active"):"endgame"==e&&$(".canvas--endgame").removeClass("is-not-active").addClass("is-active")}function w(e){if($("#debug").size()<1)return!1;var n=new Date;$("#debug").val($("#debug").val()+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()+" - "+e+"\n"),$("#debug").scrollTop($("#debug")[0].scrollHeight)}var _,T={left:0,right:0},C=20;return{init:e,render:h,addPlayer:t,getPlayer:r,setPlayerProp:a,currentTeamTotal:f,relativeTeamTotal:v,startCountDown:s,state:y,renderAddPlayer:m,debugLog:w,gotoScreen:b,renderAddPlayer:m,startPreGame:o}}();