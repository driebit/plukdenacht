var canvasApp=function(){function e(){console.log("init canvas app, start init other modules"),_=t()}function t(){return{players:{}}}function n(e){return _.players[e]={id:e},_}function r(e){return _.players[e]}function a(e,t,n){return w("setplayerprop "+t+" : "+n),r(e)[t]=n}function o(e,t,n){var r,a,o=e,s=setInterval(function(){r=parseInt(o/60,10),a=parseInt(o%60,10),r=10>r?"0"+r:r,a=10>a?"0"+a:a,t&&t.text(r+":"+a),--o<0&&(o=e,n(),clearInterval(s))},1e3)}function s(){$("#countdown_label").html(k);var e=$("body").data("starttime");o(e,$("#countdown__minutes"),i)}function i(){document.querySelector("#countdown_label").innerText="Pull!",Object.keys(_.players).map(function(e){var t=r(e);t.channel.set("isrunning",1)});var e=$("body").data("gametime");o(e,$("#countdown__minutes"),c)}function c(){document.querySelector("#countdown_label").innerText="Stand by, calculating scores...",Object.keys(_.players).map(function(e){var t=r(e);t.channel.set("isrunning",0)}),window.setTimeout(function(){b("scores");var e=v("left"),t=v("right"),n=$(".canvas--scores__players"),r=null,a=$("body").data("scoretime");e>t?($(".canvas--scores").addClass("left-won"),$(".canvas--scores__title h1").html("the eagles won!"),r="left"):($(".canvas--scores").addClass("right-won"),$(".canvas--scores__title h1").html("the bulls won!"),r="right"),u(r).sort(function(e,t){return t.score-e.score}).map(function(e){e.photo&&n.append('<li><img src="'+e.photo+'"><div>'+e.score+"</div></li>")}),o(a,null,l)},7e3)}function l(){b("endgame")}function u(e){var t=Object.keys(_.players).map(function(e){var t=r(e);return t}).filter(function(t){return t.team===e});return t}function d(){var e=Object.keys(_.players).map(function(e){var t=r(e);return t}),t=e.map(function(e){return e.score}).reduce(function(e,t){return e+t},0);return t}function m(e){var t=(Object.keys(_.players).map(function(e){var t=r(e);return t}),u(e).map(function(e){return e.score}).reduce(function(e,t){return e+t},0));return t}function v(e){var t=d();return 0==t?50:100*m(e)/t}function f(e){var t,n=r(e);t=n.photo?$('<li class="member"><img src="'+n.photo+'"></li>'):$('<li class="member"></li>');var a=T[n.team],o=$('div[class^="player-wrapper__team-'+n.team+'"]'),s=o.find(".block--"+a),i=s.find("li").size();i+1>C&&(T[n.team]++,a=T[n.team]),s.append(t)}function p(){var e=v("left"),t=v("right");$("#totalTeamA").height(e+"%"),$("#totalTeamB").height(t+"%"),w("team left: "+e+" right: "+t)}function g(){var e=v("right"),t=$(".teams-wrapper");t.css({"margin-left":160*e/100})}function y(){p(),g()}function h(){return _}function b(e){$('div[class^="canvas--"]').removeClass("is-active").addClass("is-not-active"),"scores"==e?$(".canvas--scores").removeClass("is-not-active").addClass("is-active"):"endgame"==e&&$(".canvas--endgame").removeClass("is-not-active").addClass("is-active")}function w(e){if($("#debug").size()<1)return!1;var t=new Date;$("#debug").val($("#debug").val()+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()+" - "+e+"\n"),$("#debug").scrollTop($("#debug")[0].scrollHeight)}var _,T={left:0,right:0},C=20,P=100,k="Go to<br><span>play.mooren.tv</span><br>on your phone!";return{init:e,render:y,addPlayer:n,getPlayer:r,setPlayerProp:a,currentTeamTotal:m,relativeTeamTotal:v,startCountDown:o,state:h,renderAddPlayer:f,debugLog:w,gotoScreen:b,renderAddPlayer:f,startPreGame:s,maxPlayers:P}}();